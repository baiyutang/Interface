## 统一下单接口
**简要描述：** 

- 除付款码支付场景以外，商户系统先调用该接口在各支付服务后台生成预支付交易单，返回正确的预支付交易会话标识后再按不同场景生成交易串调起支付
- 支持微信、支付宝、银联二维码交易
- 支持拉码支付、公众号支付、服务窗支付、银联JS支付、微信小程序支付、微信APP支付

**参数：** 

- 请求参数

| 参数名       | 变量名         | 必填 | 限制 | 类型   | 说明                                                         |
| :----------- | :------------- | :--- | ---- | ------ | ------------------------------------------------------------ |
| 接口名       | service        | 是   | 无   | string | get_tdcode（此为固定值)                                      |
| 支付类型     | pay_way        | 是   | 16   | string | [详见附录支付类型](#支付类型)                                |
| 商户号       | merchant_id    | 是   | 10   | string | 由乐刷分配                                                   |
| 商户订单号   | third_order_id | 是   | 64   | string | 商户内部订单号，可以包含字母：确保同一个商户下唯一           |
| 订单金额     | amount         | 是   | 10   | string | 总金额                                                       |
| 支付类型     | jspay_flag     | 是   | 1    | string | 0-微信扫码支付、支付宝扫码支付；1-微信公众号、支付宝服务窗支付<原生支付>；2-微信公众号、支付宝服务窗支付<简易支付>；3-微信小程序支付；5-微信APP支付 |
| 公众号appid  | appid          | 否   | 32   | string | 微信公众号ID                                                 |
| 用户子标识   | sub_openid     | 否   | 32   | string | 微信公众号、小程序、支付宝服务窗、银联JS支付必填             |
| 前台跳转地址 | jump_url       | 否   | 128  | string | 简易支付时必填：支付完成后，乐刷将跳转到该页面               |
| 通知地址     | notify_url     | 否   | 128  | string | 接收乐刷通知的URL                                            |
| 用户IP地址   | client_ip      | 否   | 16   | string | 商户发起交易的IP地址                                         |
| 商品描述     | body           | 否   | 256  | string | 商品描述，不能包含回车换行等特殊字符                         |
| 商户门店编号 | shop_no        | 否   | 16   | string | 只能是汉字、英文字母、数字                                   |
| 商户终端编号 | pos_no         | 否   | 16   | string | 只能是汉字、英文字母、数字                                   |
| 附加数据     | attach         | 否   | 96   | string | 原样返回                                                     |
| 指定支付方式 | limit_pay      | 否   | 1    | string | 1：禁止使用信用卡；0或者不填：不限制                         |
| 订单优惠标记 | goods_tag      | 否   | 32   | string | 订单优惠标记，透传给微信                                     |
| 商品详情     | goods_detail   | 否   | 512  | string | 按微信单品优惠券格式传递，透传给微信                         |
| 随机字符串   | nonce_str      | 是   | 32   | string | 随机字符串                                                   |
| 签名         | sign           | 是   | 32   | string | MD5签名结果                                                  |
- 返回参数

| 参数名       | 变量名         | 必填 | 限制 | 类型   | 说明                                                         |
| ------------ | -------------- | ---- | ---- | ------ | ------------------------------------------------------------ |
| 返回状态码   | resp_code      | 是   | 无   | string | 0 - 成功，非0 - 失败。注：此字段是通信标识，是否获取到二维码要看result_code |
| 返回错误信息 | resp_msg       | 否   | 无   | string | 错误描述：resp_code非0时返回                                 |
| 业务结果     | result_code    | 是   | 1    | string | 0 - 成功，非0 - 失败                                         |
| 错误码       | error_code     | 否   | 无   | string | 参考错误码                                                   |
| 错误码描述   | error_msg      | 否   | 无   | string | 错误信息描述                                                 |
| 商户号       | merchant_id    | 是   | 10   | string | 由乐刷分配                                                   |
| 商户订单号   | third_order_id | 是   | 64   | string | 商户内部订单号                                               |
| 随机字符串   | nonce_str      | 是   | 32   | string | 随机字符串                                                   |
| 签名         | sign           | 是   | 32   | string | MD5签名结果                                                  |

 **备注** 
- 获取微信用户openid
```
https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1421140842&token=&lang=zh_CN
```
- 获取支付宝用户openid
```
https://doc.open.alipay.com/doc2/detail.htm?spm=a219a.7629140.0.0.8ujLD6&treeId=115&articleId=104114&docType=1
