# 1、支付结果通知

**简要描述：** 

- 通知URL是支付接口中提交的参数notify_url。支付成功后，乐刷会把相关支付信息和用户信息发送到该URL，商户需要接收处理信息。
- 对后台通知交互时，如果收到商户的应答不是成功或者超时，乐刷认为通知失败，会通过一定的策略定期重新发起通知，尽可能的提高通知的成功率，但是不保证通知最终一定能成功。
- 由于存在重复发送后台通知的情况，因此同样的通知可能会多次发送给商户系统。系统必须能够正确处理重复的通知。

**通知参数：**

| 参数名               | 变量名             | 必填 | 限制 | 类型   | 说明                                                         |
| -------------------- | ------------------ | ---- | ---- | ------ | ------------------------------------------------------------ |
| 错误码               | error_code         | 否   | 无   | string | 参考错误码                                                   |
| 签名                 | sign               | 是   | 32   | string | MD5签名结果                                                  |
| 商户号               | merchant_id        | 是   | 10   | string | 乐刷商户号                                                   |
| 乐刷订单号           | leshua_order_id    | 是   | 32   | string |                                                              |
| 商户订单号           | third_order_id     | 是   | 64   | string |                                                              |
| 订单金额             | amount             | 是   | 无   | string |                                                              |
| 订单状态             | status             | 是   | 无   | string | [详见附录订单状态](#订单状态)                                |
| 支付类型             | pay_way            | 是   | 无   | string | [详见附录支付类型](#支付类型)                                |
| 支付时间             | pay_time           | 是   | 无   | string | '2018-08-20 19:19:19'                                        |
| 银行类型             | bank_type          | 否   | 无   | string | [详见附录付款银行类型](#付款银行类型)                        |
| 用户openid           | openid             | 否   | 无   | string |                                                              |
| 微信、支付宝等订单号 | out_transaction_id | 否   | 无   | string |                                                              |
| 用户子标识           | sub_openid         | 否   | 无   | string | 支付成功时才返回。微信：微信公众号APPID 下用户唯一标识；支付宝：买家的支付宝用户ID |
| 附加数据             | attach             | 否   | 96   | string | 原样返回                                                     |
| 交易类型             | trade_type         | 否   | 无   | string | 支付成功时才返回：MICROPAY-条码支付，NATIVE-原生扫码支付，JSAPI-公众号支付、服务窗支付，APP--app支付，H5Pay-支付支付，SmPgPay-小程序支付，JSAPIQuick-简易支付 |
| 订单优惠标记         | goods_tag          | 否   | 32   | string | 支付成功时才返回。订单优惠标记                               |
| 通道订单号           | channel_order_id   | 否   | 无   | string | 支付成功时才返回                                             |
| 通道订单时间         | channel_datetime   | 否   | 无   | string | 支付成功时才返回                                             |
| 支付宝红包金额       | coupon             | 否   | 无   | string | 支付成功时才返回                                             |
| 应结算金额           | settlement_amount  | 否   | 无   | string | 实际结算金额，支付成功时才返回                               |
| 折扣优惠金额         | discount_amount    | 否   | 无   | string | 本订单优惠金额，支付成功时才返回                             |
| 优惠详情             | promotion_detail   | 否   | 无   | string | 优惠详情                                                     |
| 活动标志             | active_flag        | 否   | 无   | string | 活动标志：WXLZ：微信绿洲 ZFBLH：支付宝蓝海                   |
| 买家实付金额         | buyer_pay_amount   | 否   | 无   | String | 微信、支付宝此值有效                                         |

# 2、退款结果通知

**简要描述：** 

- 通知URL是退款请求中提交的参数notify_url。退款成功或者失败后，乐刷会把相关退款信息发送到该URL，商户需要接收处理信息。
- 对后台通知交互时，如果收到商户的应答不是成功或者超时，乐刷认为通知失败，会通过一定的策略定期重新发起通知，尽可能的提高通知的成功率，但是不保证通知最终一定能成功。
- 由于存在重复发送后台通知的情况，因此同样的通知可能会多次发送给商户系统。系统必须能够正确处理重复的通知。
- 注意通知签名key与交易签名key不一样。

**通知参数：**

| 字段名     | 变量名             | 必填 | 长度限制 | 类型   | 说明                          |
| ---------- | ------------------ | ---- | -------- | ------ | ----------------------------- |
| 错误码     | error_code         | 否   | 无       | string | 参考错误码                    |
| 随机字符串 | nonce_str          | 是   | 32       | string | 随机字符串                    |
| 签名       | sign               | 是   | 32       | string | MD5签名结果                   |
| 订单状态   | status             | 是   | 无       | string | [详见附录订单状态](#订单状态) |
| 失败原因   | failure_reason     | 否   | 无       | string | 失败原因                      |
| 商户号     | merchant_id        | 是   | 10       | string | 由乐刷分配                    |
| 商户订单号 | third_order_id     | 是   | 64       | string | 商户内部订单号                |
| 乐刷订单号 | leshua_order_id    | 是   | 32       | string | 乐刷订单号                    |
| 退款金额   | refund_amount      | 是   | 无       | string | 退款金额                      |
| 商户退款id | merchant_refund_id | 是   | 64       | string |                               |
| 乐刷退款id | leshua_refund_id   | 是   | 32       | string |                               |
| 订单总金额 | total_amount       | 是   | 无       | string |                               |
| 退款时间   | refund_time        | 否   | 无       | string | 退款成功时间：退款成功才返回  |
